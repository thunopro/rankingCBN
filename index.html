<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Coding Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --surface-color: #ffffff;
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --border-color: #e2e8f0;
            --text-heading: #1e293b;
            --text-body: #475569;
            --github-green: #22c55e;
            --github-empty: #f1f5f9;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-body);
            margin: 0;
            padding: 40px 15px;
            display: flex;
            justify-content: center;
            -webkit-font-smoothing: antialiased;
        }

        .wrapper {
            width: 100%;
            max-width: 1200px;
            background: var(--surface-color);
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .header-section {
            padding: 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-section h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            color: var(--text-heading);
            letter-spacing: -0.5px;
        }

        .badge-info {
            background: #eff6ff;
            color: var(--primary-color);
            padding: 6px 14px;
            border-radius: 99px;
            font-size: 13px;
            font-weight: 600;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
        }

        th {
            background: #fdfdfd;
            padding: 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--secondary-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            vertical-align: middle;
        }

        tr:last-child td { border-bottom: none; }

        tr:hover { background-color: #f8fafc; }

        /* Styling cho cột User */
        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #60a5fa 0%, #2563eb 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        }

        .user-meta { display: flex; flex-direction: column; }
        .user-name { font-weight: 600; color: var(--text-heading); }
        .user-handle { font-size: 11px; color: var(--secondary-color); }

        /* Styling cho Badge Tổng AC */
        .ac-total-badge {
            background: var(--github-green);
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 700;
            display: inline-block;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.25);
        }

        /* Styling các ô Ngày */
        .day-box {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            border-radius: 10px;
            font-weight: 600;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .day-box:hover { transform: scale(1.1); }

        .active-day {
            background: #dcfce7;
            color: #15803d;
            border: 1.5px solid #bdf4cf;
        }

        .inactive-day {
            background: var(--github-empty);
            color: #94a3b8;
            border: 1px solid #e2e8f0;
        }

        .footer {
            padding: 20px 30px;
            background: #fafafa;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            color: var(--secondary-color);
        }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header-section">
        <h1>Member Activity <span style="font-weight: 300;">Tracker</span></h1>
        <div class="badge-info">Last 10 Days Analysis</div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr id="head-row">
                    <th style="width: 60px; text-align: center;">Rank</th>
                    <th style="text-align: left;">Member</th>
                    <th style="text-align: center;">Total AC</th>
                </tr>
            </thead>
            <tbody id="data-body"></tbody>
        </table>
    </div>

    <div class="footer">
        <div>&copy; 2026 Codeforces Tracker Engine</div>
        <div id="update-time"></div>
    </div>
</div>

<script>
async function render() {
    try {
        const [resUsers, resSubs] = await Promise.all([
            fetch('./data/handles.json'),
            fetch('./data/recent_activity.json')
        ]);
        const users = await resUsers.json();
        const submissions = await resSubs.json();

        // 1. Tạo 10 cột ngày
        const days = [];
        for (let i = 0; i < 10; i++) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            days.push(d.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' }).replace('/', '-'));
        }

        // Vẽ Header ngày
        const headRow = document.getElementById('head-row');
        days.forEach(day => {
            const th = document.createElement('th');
            th.style.textAlign = 'center';
            th.innerText = day;
            headRow.appendChild(th);
        });

        // 2. Xử lý dữ liệu tương tự index.html cũ
        const results = users.map(user => {
            const userSubs = submissions.filter(s => s.handle === user.handle && s.verdict === 'OK');
            const daily = {};
            const totalSet = new Set();

            userSubs.forEach(s => {
                const dateStr = new Date(s.creationTimeSeconds * 1000)
                                .toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' })
                                .replace('/', '-');
                if (days.includes(dateStr)) {
                    if (!daily[dateStr]) daily[dateStr] = new Set();
                    daily[dateStr].add(s.problem);
                    totalSet.add(s.problem);
                }
            });
            return { name: user.name, handle: user.handle, total: totalSet.size, daily };
        });

        // Sắp xếp
        results.sort((a, b) => b.total - a.total);

        // 3. Render
        const tbody = document.getElementById('data-body');
        results.forEach((user, i) => {
            const tr = document.createElement('tr');
            let rowHtml = `
                <td style="text-align: center; font-weight: 700; color: #cbd5e1;">0${i + 1}</td>
                <td>
                    <div class="user-cell">
                        <div class="user-avatar">${user.name.charAt(0)}</div>
                        <div class="user-meta">
                            <span class="user-name">${user.name}</span>
                            <span class="user-handle">@${user.handle}</span>
                        </div>
                    </div>
                </td>
                <td style="text-align: center;">
                    <span class="ac-total-badge">${user.total}</span>
                </td>
            `;

            days.forEach(day => {
                const count = user.daily[day] ? user.daily[day].size : 0;
                const statusClass = count > 0 ? 'active-day' : 'inactive-day';
                rowHtml += `<td><div class="day-box ${statusClass}">${count}</div></td>`;
            });

            tr.innerHTML = rowHtml;
            tbody.appendChild(tr);
        });

        document.getElementById('update-time').innerText = "Last sync: " + new Date().toLocaleTimeString();
    } catch (e) { console.error(e); }
}
render();
</script>
</body>
</html>